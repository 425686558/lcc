<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<html>

	<head>
		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
		<link title="David R. Hanson" href="http://drh.home.dyndns.org" rev="made">
		<link href="style.css" rel="stylesheet" type="text/css" media="all">
		<title>2nd Printing Errata: A Retargetable C Compiler</title>
	</head>

	<body>
		<p><span class="banner"><a href="http://www.cs.princeton.edu">Princeton CS</a> &raquo; <a href="http://www.cs.princeton.edu/software">Software</a> &raquo; <a href="http://www.cs.princeton.edu/software/lcc/">lcc, A Retargetable C Compiler</a> &raquo; 2nd Printing Errata</span></p>
		<h3><cite>A Retargetable C Compiler: Design and Implementation</cite><br>
			Addison-Wesley, 1995, ISBN 0-8053-1670-1</h3>
		<h2>Second Printing Errata</h2>
		<p>In the lists below, line +<i>n</i> and line -<i>n</i> refer to the <i>n</i>th line from the top and bottom of the indicated page.</p>
		<p>Page 342, lines +12..15: this code should read</p>
		<blockquote>
			<pre>defglobal(cp-&gt;u.swtch.table, LIT);
(*IR-&gt;defaddress)(equated(cp-&gt;u.swtch.labels[0]));
for (i = 1; i &lt; cp-&gt;u.swtch.size; i++) {
	long k = cp-&gt;u.swtch.values[i-1];
	while (++k &lt; cp-&gt;u.swtch.values[i])
</pre>
		</blockquote>
		<p><a name="first"></a>The errors below also appear in the <a href="1.html">first printing</a>.</p>
		<p>Page 8, line -22: Change `<tt>ADDRGP</tt>' to `<tt>ADDRFP</tt>'.</p>
		<p>Page 15, line +7: In Table 1.1, `<tt>ops.h</tt>' should be `<tt>c.h</tt>'.</p>
		<p>Page 18, line +1: `<tt>va_dcl</tt>;' should be `<tt>va_dcl</tt>'.</p>
		<p>Page 24, line +12: Change `disasterous' to `disastrous'.</p>
		<p>Page 24, line -12: Change `incidently' to `incidentally'.</p>
		<p>Page 26, line -8: To avoid invalid pointers, the condition should read `<tt>n &gt; ap-&gt;limit - ap-&gt;avail</tt>'.</p>
		<p>Page 28, line +3: Change `<tt>10*1024</tt>' to `<tt>roundup(10*1024, sizeof (union align))</tt>'.</p>
		<p>Page 31, line +20: To avoid invalid pointers, the condition should read `<tt>len + 1 &gt;= strlimit - next</tt>'.</p>
		<p>Page 52, line +5: `<tt>tables</tt>' should be `<tt>symbols</tt>'.</p>
		<p>Page 56, line +11: `<tt>40 4</tt>' should be `<tt>4 40</tt>'.</p>
		<p>Page 56, line -17: Change `can' to `can be'.</p>
		<p>Page 57, line +3: Change `<tt>NEW</tt>' to `<tt>NEW0</tt>'.</p>
		<p>Page 57, line +9: Delete.</p>
		<p>Page 64, lines -6..-3: Change these lines to</p>
		<blockquote>
			Internally, the prototype for functions with no arguments is empty;<br>
			it consists of only the terminating null. Thus, the type of <tt>f<br>
			</tt>is depicted as
			<blockquote>
				<pre>(FUNCTION (VOID) {})</pre>
			</blockquote>
		</blockquote>
		<p>Page 65, line +1: The correct prototype for <tt>sprintf</tt> is</p>
		<blockquote>
			<pre>int sprintf(char *, const char *, ...)</pre>
		</blockquote>
		<p>Page 65, line +8: `<tt>(CHAR)</tt>' should read `<tt>(CONST (CHAR))</tt>'.</p>
		<p>Page 65, line -15: Change `one or more' to `zero or more'.</p>
		<p>Page 65, lines -13..-12: Change `one-element prototype <tt>{(VOID)}</tt>' to `zero-length prototype <tt>{}</tt>'.</p>
		<p>Page 71, line +22: Change to</p>
		<blockquote>
			<pre>if (promote(ty) != (isenum(ty) ? ty-&gt;type : ty)
|| ty == floattype)</pre>
		</blockquote>
		<p>Page 74, line -9: Change `the bit strings' to `bit strings'.</p>
		<p>Page 82, line +5: Change `exceed' to `exceeds'.</p>
		<p>Page 83, lines +13..14: Should read `<tt>ADDP</tt>, in which an integer operand in <tt>kids[1]</tt> is added to a pointer operand in <tt>kids[0]</tt>,'</p>
		<p>Page 97, lines +5..6: Change `Exercises 5.2 and 5.1' to 'Exercises 5.1 and 5.2'.</p>
		<p>Page 106, lines +9..16: Change to</p>
		<blockquote>
			<pre>	} else {
		lineno++;
		for (line = (char *)cp; *cp==' ' || *cp=='\t'; cp++)
			;
		if (*cp == '#') {
			resynch();
			nextline();
		}
	}
} while (*cp == '\n' &amp;&amp; cp == limit);</pre>
		</blockquote>
		<p>Page 113, line +5: Change `28' to `32'.</p>
		<p>Page 113, line +8: Add the line</p>
		<blockquote>
			<pre>case        enum      register  typedef</pre>
		</blockquote>
		<p>Page 118, lines +6 and +11: Change `<tt>LONG_MAX</tt>' to `<tt>~(1&lt;&lt;8*longtype-&gt;size - 1)</tt>'.</p>
		<p>Page 118, line +13: Change `<tt>INT_MAX</tt>' to `<tt>~(1&lt;&lt;8*inttype-&gt;size - 1)</tt>'.</p>
		<p>Page 118, line +20: Change to</p>
		<blockquote>
			<pre>n = ~(1&lt;&lt;8*longtype-&gt;size - 1);
tval.type = longtype;</pre>
		</blockquote>
		<p>Page 124, line +21: `<tt>&amp;cbuf[sizeof cbuf] - 2</tt>' should read `<tt>&amp;cbuf[sizeof cbuf] - 1</tt>'.</p>
		<p>Page 134, line +10: `<tt>return 1</tt>' should read `<tt>return 0</tt>'.</p>
		<p>Pages 155-182: Occurrences of &lt;<i>tree.c data</i>&gt;, &lt;<i>tree.c exported macros</i>&gt;, and &lt;<i>tree.c functions</i>&gt; should be changed to &lt;<i>expr.c data</i>&gt;, &lt;<i>expr.c exported macros</i>&gt;, and &lt;<i>expr.c functions</i>&gt;.</p>
		<p>Page 173, line -1: `<code>(POINTER</code> <i>T</i><code>)</code> decay into <code>(FUNCTION</code> <i>T</i><code>)</code>' should read `<code>(FUNCTION</code> <i>T</i><code>)</code> decay into <code>(POINTER</code> <i>T</i><code>)</code>'.</p>
		<p>Page 181, line -7: `which is has' should be `which has'.</p>
		<p>Page 186, line +23: Change to</p>
		<blockquote>
			<pre>ty = func(voidtype, NULL, 1);
p = retype(p, ptr(ty));</pre>
		</blockquote>
		<p>Page 227, line -4: `<i>expression</i> <tt>!=</tt> 0' should be `<i>expression</i> <tt>==</tt> 0'.</p>
		<p>Page 229, lines +13, -1: `<code>defpoint</code>' should be `<code>definept</code>'.</p>
		<p>Page 256, line -1: Change to</p>
		<blockquote>
			<pre>ty = tsym-&gt;type;
if (isqual(ty)
&amp;&amp; ty-&gt;size != ty-&gt;type-&gt;size) {
	ty = unqual(ty);
	if (isconst(tsym-&gt;type))
		ty = qual(CONST, ty);
	if (isvolatile(tsym-&gt;type))
		ty = qual(VOLATILE, ty);
	tsym-&gt;type = ty;
}</pre>
		</blockquote>
		<p>Page 289, lines +17..18: Change to</p>
		<blockquote>
			<pre>{
	Type ty = unqual(proto[i]);
	if (eqtype(isenum(ty) ? ty-&gt;type : ty,
		unqual(caller[i]-&gt;type), 1) == 0)
		break;
}</pre>
		</blockquote>
		<p>Page 320, lines -4, -18: `32 - <i>m</i>' to `32 - <i>m</i> - <i>s</i>' (the definition of <code>fieldleft</code> on p. 66 is correct).</p>
		<p>Page 345, line -14: `<code>*t2</code>' should be `<code>t2</code>'.<font size="2">&nbsp;</font></p>
		<p>Page 349, line +19: Change `similer' to `similar'.</p>
		<p>Page 354, line +8: Change `<code>emit</code>' to `<code>emitcode</code>'.</p>
		<p>Page 373, lines -4, -7, -8: Change `<code>ADDI</code>' to `<code>ADDP</code>'.</p>
		<p>Page 374, Figure 14.1: Change `<code>ADDP(addr,con)</code>' to `<code>ADDP(reg,con)</code>'.</p>
		<p>Page 375, line -19: Change `BURM.' to `BURM'.</p>
		<p>Page 380, line +10: Change `5' to `<tt>4</tt>'.</p>
		<p>Page 383, lines -6..-7: Change `value of <tt>i</tt>' to `value of <tt>q-&gt;b</tt>' and `<tt>x[0]</tt>' to `<tt>p-&gt;b</tt>'.</p>
		<p>Page 398, line +10: `<code>preload</code>' should be `<code>prelabel</code>'.</p>
		<p>Page 411, line +1: Change `<tt>askfixedregr</tt>' to `<tt>askfixedreg</tt>'.</p>
		<p>Page 411, line -3: Change `<tt>askregvar</tt>' to `<tt>askreg</tt>'.</p>
		<p>Page 445, line +7: Change `placement' to `placement of'.</p>
		<p>Page 451, line -7: Change `<tt>4</tt>' to `<tt>usedmask[FREG] ? 8 : 4</tt>'.</p>
		<p>Page 488, line +10: Change to</p>
		<blockquote>
			<pre>print(&quot;.align 4\n%s:\n&quot;, f-&gt;x.name);</pre>
		</blockquote>
		<p>Page 489, lines -10: Change to</p>
		<blockquote>
			<p><tt>{ </tt>&lt;<i>spill floats and doubles from </i><tt>i0-i5</tt><font size="-1"> 489</font>&gt;<tt> }</tt></p>
		</blockquote>
		<p>Page 493, lines -6, -4 and<br>
			Page 494, lines +14, +15: Change occurrences of `<tt>tmp</tt>' to `<tt>tmps</tt>'.</p>
		<p>Page 502, lines -18, -15: Change occurrences of `<tt>nstate</tt>' to `<tt>nstack</tt>'.</p>
		<p>Thanks to Nelson Beebe, Franklin Chen, Ming Chen, Amnon Cohen, Russ Cox, Marcin Ciura, Guy Laden, Jonathan Litt, Paul Mattal, Scott Nicholas, Richard O'Keefe, Norman Ramsey, Sukyoung Ryu, Duane Sand, Bernie Solomon, Reuben Thomas, Gary Tyson, and Lei Zhou for finding some of these errors.</p>
		<hr>
		<address><a href="http://cwfraser.webhop.net">Chris Fraser</a><br>
			<a href="http://drh.home.dyndns.org">David Hanson</a><br>
			$Revision: 1.24 $ $Date$</address>
	</body>

</html>